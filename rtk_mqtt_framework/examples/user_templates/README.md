# RTK MQTT Framework ä½¿ç”¨è€…ç¯„ä¾‹

æ­¡è¿ä½¿ç”¨ RTK MQTT Framework ä½¿ç”¨è€…ç¯„ä¾‹é›†ï¼é€™äº›ç¯„ä¾‹æä¾›äº†å¾åŸºç¤åˆ°é€²éšçš„å®Œæ•´å­¸ç¿’è·¯å¾‘ï¼Œå¹«åŠ©æ‚¨å¿«é€ŸæŒæ¡ RTK MQTT Framework çš„ä½¿ç”¨å’Œæœ€ä½³å¯¦è¸ã€‚

## ğŸ“š å­¸ç¿’è·¯å¾‘

é€™äº›ç¯„ä¾‹æŒ‰ç…§ç”±æ·ºå…¥æ·±çš„é †åºè¨­è¨ˆï¼Œå»ºè­°ä¾åºå­¸ç¿’ï¼š

### ğŸš€ [01_hello_world](01_hello_world/) - MQTT åŸºç¤å…¥é–€
**å­¸ç¿’æ™‚é–“**: 30 åˆ†é˜  
**é›£åº¦**: â­  

```
æœ€ç°¡å–®çš„ MQTT å®¢æˆ¶ç«¯ç¯„ä¾‹ï¼Œåƒ… 20 è¡Œä»£ç¢¼
â”œâ”€â”€ main.c          # æ¥µç°¡ MQTT ç™¼å¸ƒç¯„ä¾‹
â”œâ”€â”€ Makefile        # ç¨ç«‹å»ºæ§‹ç³»çµ±
â””â”€â”€ README.md       # è©³ç´°èªªæ˜å’Œæ•…éšœæ’é™¤
```

**æ‚¨å°‡å­¸åˆ°**:
- RTK MQTT Framework åŸºæœ¬ç”¨æ³•
- é€£æ¥ MQTT broker å’Œç™¼å¸ƒè¨Šæ¯
- ç¨ç«‹ Makefile çš„ä½¿ç”¨
- åŸºç¤æ•…éšœæ’é™¤æŠ€å·§

---

### ğŸ“Š [02_basic_sensor](02_basic_sensor/) - æ„Ÿæ¸¬å™¨æ¨¡æ“¬
**å­¸ç¿’æ™‚é–“**: 1-2 å°æ™‚  
**é›£åº¦**: â­â­  

```
æŒçºŒé‹è¡Œçš„æ„Ÿæ¸¬å™¨è¨­å‚™æ¨¡æ“¬
â”œâ”€â”€ sensor.c        # æ„Ÿæ¸¬å™¨æ¨¡æ“¬å’Œé€±æœŸç™¼å¸ƒ
â”œâ”€â”€ Makefile        # é€²éšå»ºæ§‹ç³»çµ± (debug/release/daemon)
â”œâ”€â”€ config.json     # JSON é…ç½®æª”æ¡ˆç¯„ä¾‹
â””â”€â”€ README.md       # æ·±å…¥çš„ä»£ç¢¼è§£æå’Œæœ€ä½³åŒ–æŒ‡å—
```

**æ‚¨å°‡å­¸åˆ°**:
- é€±æœŸæ€§é™æ¸¬è³‡æ–™ç™¼å¸ƒ
- RTK ä¸»é¡Œçµæ§‹çš„ä½¿ç”¨
- JSON é…ç½®æª”æ¡ˆç®¡ç†
- ä¿¡è™Ÿè™•ç†å’Œå„ªé›…é€€å‡º
- èƒŒæ™¯åŸ·è¡Œå’Œç¨‹åºç®¡ç†

---

### ğŸ­ [03_complete_device](03_complete_device/) - ç”Ÿç”¢ç´šè¨­å‚™
**å­¸ç¿’æ™‚é–“**: 3-4 å°æ™‚  
**é›£åº¦**: â­â­â­â­  

```
ä¼æ¥­ç´š IoT è¨­å‚™å®Œæ•´å¯¦ä½œ
â”œâ”€â”€ device.c        # å¤šåŸ·è¡Œç·’æ¶æ§‹ (390+ è¡Œ)
â”œâ”€â”€ Makefile        # ä¼æ¥­ç´šå»ºæ§‹ç³»çµ±
â”œâ”€â”€ config.json     # å®Œæ•´é…ç½®æª”æ¡ˆ
â””â”€â”€ README.md       # ç”Ÿç”¢ç´šé–‹ç™¼æŒ‡å—
```

**æ‚¨å°‡å­¸åˆ°**:
- å¤šåŸ·è¡Œç·’æ¶æ§‹è¨­è¨ˆ (æ„Ÿæ¸¬å™¨/å‘½ä»¤/å¥åº·ç›£æ§)
- å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶
- ä¼æ¥­ç´šå»ºæ§‹ç³»çµ± (éœæ…‹åˆ†æã€è¨˜æ†¶é«”æª¢æŸ¥ã€æ‰“åŒ…)
- é…ç½®æª”æ¡ˆç®¡ç†å’Œæ—¥èªŒç³»çµ±
- å¥åº·ç›£æ§å’Œè‡ªå‹•é‡é€£
- å„ªé›…å•Ÿå‹•å’Œé—œé–‰ç¨‹åº

---

### ğŸŒ [04_cross_platform](04_cross_platform/) - è·¨å¹³å°é–‹ç™¼
**å­¸ç¿’æ™‚é–“**: 2-3 å°æ™‚  
**é›£åº¦**: â­â­â­â­â­  

```
å¤šå¹³å°ç›¸å®¹çš„è¨­å‚™ç¨‹å¼
â”œâ”€â”€ cross_platform_device.c  # å¹³å°æŠ½è±¡å±¤å¯¦ä½œ
â”œâ”€â”€ Makefile                 # å¤šå¹³å°å»ºæ§‹ç³»çµ±
â””â”€â”€ README.md                # è·¨å¹³å°é–‹ç™¼æŒ‡å—
```

**æ”¯æ´å¹³å°**:
- **POSIX** (Linux/macOS) - pthread, BSD socket
- **Windows** - WinAPI, Winsock2  
- **ARM FreeRTOS** - FreeRTOS Tasks, LwIP

**æ‚¨å°‡å­¸åˆ°**:
- å¹³å°æŠ½è±¡å±¤è¨­è¨ˆæ¨¡å¼
- æ¢ä»¶ç·¨è­¯å’Œå¹³å°æª¢æ¸¬
- å¤šå¹³å°å»ºæ§‹ç³»çµ±é…ç½®
- åŸ·è¡Œç·’å’ŒåŒæ­¥çš„å¹³å°å·®ç•°
- åµŒå…¥å¼ç³»çµ±ç¨‹å¼è¨­è¨ˆæœ€ä½³å¯¦è¸

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿé–‹å§‹

```bash
# 1. é€²å…¥ä»»ä½•ä¸€å€‹ç¯„ä¾‹ç›®éŒ„
cd 01_hello_world

# 2. æª¢æŸ¥å»ºæ§‹ç’°å¢ƒ
make check-rtk

# 3. å»ºæ§‹å’ŒåŸ·è¡Œ
make run
```

### æ‰€æœ‰ç¯„ä¾‹éƒ½æ”¯æ´çš„é€šç”¨å‘½ä»¤

```bash
make              # åŸºæœ¬å»ºæ§‹
make run          # å»ºæ§‹ä¸¦åŸ·è¡Œ
make debug        # é™¤éŒ¯ç‰ˆæœ¬
make release      # æœ€ä½³åŒ–ç‰ˆæœ¬
make clean        # æ¸…ç†å»ºæ§‹ç”¢ç‰©
make help         # é¡¯ç¤ºè©³ç´°èªªæ˜
```

### ç¯„ä¾‹ç‰¹æœ‰åŠŸèƒ½

| åŠŸèƒ½ | 01_hello | 02_sensor | 03_complete | 04_cross |
|------|----------|-----------|-------------|----------|
| åŸºæœ¬å»ºæ§‹ | âœ… | âœ… | âœ… | âœ… |
| é™¤éŒ¯æ¨¡å¼ | âœ… | âœ… | âœ… | âœ… |
| èƒŒæ™¯åŸ·è¡Œ | âŒ | âœ… | âœ… | âŒ |
| é…ç½®æª”æ¡ˆ | âŒ | âœ… | âœ… | âŒ |
| å¤šåŸ·è¡Œç·’ | âŒ | âŒ | âœ… | âœ… |
| è·¨å¹³å°å»ºæ§‹ | âŒ | âŒ | âŒ | âœ… |
| éœæ…‹åˆ†æ | âŒ | âŒ | âœ… | âŒ |
| è¨˜æ†¶é«”æª¢æŸ¥ | âŒ | âŒ | âœ… | âŒ |
| åˆ†ç™¼æ‰“åŒ… | âŒ | âŒ | âœ… | âŒ |

## ğŸ“‹ ç³»çµ±éœ€æ±‚

### åŸºæœ¬éœ€æ±‚ (æ‰€æœ‰ç¯„ä¾‹)

```bash
# RTK MQTT Framework (å·²é å…ˆå»ºæ§‹)
â”œâ”€â”€ include/rtk_mqtt_framework/    # æ¨™é ­æª”
â””â”€â”€ lib/librtk_mqtt_framework.a    # å‡½å¼åº«

# ç·¨è­¯å·¥å…·
gcc 4.8+                          # C ç·¨è­¯å™¨
make 3.8+                         # å»ºæ§‹å·¥å…·

# ç³»çµ±å‡½å¼åº«
pthread                           # åŸ·è¡Œç·’æ”¯æ´ (POSIX)
libm                             # æ•¸å­¸å‡½å¼åº«
```

### è·¨å¹³å°å»ºæ§‹éœ€æ±‚ (åƒ… 04_cross_platform)

```bash
# Windows äº¤å‰ç·¨è­¯
gcc-mingw-w64                     # MinGW å·¥å…·éˆ

# ARM FreeRTOS äº¤å‰ç·¨è­¯  
gcc-arm-none-eabi                 # ARM GCC å·¥å…·éˆ
/opt/freertos                     # FreeRTOS æºç¢¼ (è¨­å®š FREERTOS_PATH)
```

### æ¸¬è©¦å’Œåˆ†æå·¥å…· (é¸ç”¨)

```bash
# å“è³ªä¿è­‰å·¥å…·
valgrind                          # è¨˜æ†¶é«”æª¢æŸ¥
cppcheck                          # éœæ…‹åˆ†æ  
clang-format                      # ä»£ç¢¼æ ¼å¼åŒ–

# MQTT æ¸¬è©¦å·¥å…·
mosquitto-clients                 # mosquitto_pub/sub
```

## ğŸ§ª æ¸¬è©¦å’Œé©—è­‰

### å¿«é€Ÿé©—è­‰æ‰€æœ‰ç¯„ä¾‹

```bash
#!/bin/bash
# æ¸¬è©¦æ‰€æœ‰ç¯„ä¾‹çš„è…³æœ¬

examples=("01_hello_world" "02_basic_sensor" "03_complete_device" "04_cross_platform")

for example in "${examples[@]}"; do
    echo "æ¸¬è©¦ $example..."
    cd "$example"
    
    if make test 2>/dev/null; then
        echo "âœ… $example æ¸¬è©¦é€šé"
    else
        echo "âŒ $example æ¸¬è©¦å¤±æ•—"
    fi
    
    cd ..
    echo ""
done
```

### MQTT é€šä¿¡é©—è­‰

```bash
# ç›£è½æ‰€æœ‰ç¯„ä¾‹çš„ MQTT è¨Šæ¯
mosquitto_sub -h test.mosquitto.org -t "rtk/v1/+/+/+/+"

# é æœŸçœ‹åˆ°çš„ä¸»é¡Œæ ¼å¼:
# rtk/v1/demo_tenant/demo_site/hello_world_001/telemetry/message
# rtk/v1/demo_tenant/demo_site/basic_sensor_001/telemetry/temperature  
# rtk/v1/demo_tenant/demo_site/complete_device_001/state
# rtk/v1/demo_tenant/demo_site/cross_platform_Linux_001/evt/platform.info
```

## ğŸ¯ é¸æ“‡é©åˆçš„ç¯„ä¾‹

### æ ¹æ“šæ‚¨çš„éœ€æ±‚é¸æ“‡

| å¦‚æœæ‚¨æƒ³è¦... | æ¨è–¦ç¯„ä¾‹ | åŸå›  |
|---------------|----------|------|
| å¿«é€Ÿäº†è§£ RTK æ¡†æ¶ | `01_hello_world` | æœ€ç°¡å–®ï¼Œ5 åˆ†é˜å³å¯é‹è¡Œ |
| å»ºç«‹æ„Ÿæ¸¬å™¨è¨­å‚™ | `02_basic_sensor` | å®Œæ•´çš„æ„Ÿæ¸¬å™¨æ¨¡æ“¬å’Œé…ç½®ç®¡ç† |
| é–‹ç™¼ç”Ÿç”¢ç´šè¨­å‚™ | `03_complete_device` | ä¼æ¥­ç´šåŠŸèƒ½å’Œå»ºæ§‹ç³»çµ± |
| æ”¯æ´å¤šå€‹å¹³å° | `04_cross_platform` | è·¨å¹³å°æŠ½è±¡å±¤å’Œå»ºæ§‹æ”¯æ´ |
| å­¸ç¿’ MQTT å”è­° | `01_hello_world` â†’ `02_basic_sensor` | å¾ªåºæ¼¸é€²äº†è§£ RTK ä¸»é¡Œçµæ§‹ |
| å­¸ç¿’å¤šåŸ·è¡Œç·’ç¨‹å¼è¨­è¨ˆ | `03_complete_device` | ç”Ÿç”¢ç´šå¤šåŸ·è¡Œç·’æ¶æ§‹ç¯„ä¾‹ |
| åµŒå…¥å¼ç³»çµ±é–‹ç™¼ | `04_cross_platform` | FreeRTOS æ”¯æ´å’Œè³‡æºæœ€ä½³åŒ– |

### æ ¹æ“šæ‚¨çš„ç¶“é©—æ°´å¹³

| ç¶“é©—æ°´å¹³ | å»ºè­°å­¸ç¿’è·¯å¾‘ | é ä¼°æ™‚é–“ |
|----------|--------------|----------|
| **åˆå­¸è€…** | `01` â†’ `02` â†’ æš«åœè¤‡ç¿’ | 2-3 å°æ™‚ |
| **ä¸­ç´šé–‹ç™¼è€…** | `01` â†’ `02` â†’ `03` | 4-6 å°æ™‚ |
| **é«˜ç´šé–‹ç™¼è€…** | å…¨éƒ¨ç¯„ä¾‹ + è‡ªè¨‚ä¿®æ”¹ | 6-8 å°æ™‚ |
| **æ¶æ§‹å¸«/æŠ€è¡“ä¸»ç®¡** | é‡é»é—œæ³¨ `03` å’Œ `04` | 3-4 å°æ™‚ |

## ğŸ”§ å¸¸è¦‹å•é¡Œ

### Q: å¦‚ä½•ç¢ºèª RTK æ¡†æ¶å·²æ­£ç¢ºå®‰è£ï¼Ÿ

**A**: åŸ·è¡Œä»»ä½•ç¯„ä¾‹çš„æª¢æŸ¥å‘½ä»¤ï¼š
```bash
cd 01_hello_world
make check-rtk
```

### Q: ç·¨è­¯æ™‚æç¤ºæ‰¾ä¸åˆ°æ¨™é ­æª”ï¼Ÿ

**A**: æª¢æŸ¥ RTK æ¡†æ¶è·¯å¾‘è¨­å®šï¼š
```bash
ls -la ../../include/rtk_mqtt_framework/
ls -la ../../lib/librtk_mqtt_framework.a

# å¦‚æœè·¯å¾‘ä¸æ­£ç¢ºï¼Œèª¿æ•´ Makefile ä¸­çš„è·¯å¾‘
RTK_INCLUDE_DIR = /path/to/your/rtk/include
RTK_LIB_DIR = /path/to/your/rtk/lib
```

### Q: ç„¡æ³•é€£æ¥åˆ° MQTT brokerï¼Ÿ

**A**: æª¢æŸ¥ç¶²è·¯é€£æ¥ï¼š
```bash
# æ¸¬è©¦é€£æ¥æ€§
ping test.mosquitto.org
telnet test.mosquitto.org 1883

# æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
sudo ufw status

# å˜—è©¦å…¶ä»– broker
# ç·¨è¼¯æºç¢¼ä¸­çš„ broker ä½å€ç‚ºæ‚¨çš„ç§æœ‰ broker
```

### Q: æƒ³ä½¿ç”¨è‡ªå·±çš„ MQTT brokerï¼Ÿ

**A**: ä¿®æ”¹å„ç¯„ä¾‹ä¸­çš„ broker è¨­å®šï¼š
```c
// åœ¨æºç¢¼ä¸­æ‰¾åˆ°ä¸¦ä¿®æ”¹
rtk_mqtt_client_t* client = rtk_mqtt_client_create(
    "your.mqtt.broker.com",    // æ‚¨çš„ broker ä½å€
    1883,                      // åŸ è™Ÿ
    "your_device_id"           // è¨­å‚™ ID
);
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ„Ÿæ¸¬å™¨é¡å‹ï¼Ÿ

**A**: åƒè€ƒ `02_basic_sensor` çš„æ¨¡å¼ï¼š
```c
// 1. æ·»åŠ æ„Ÿæ¸¬å™¨è®€å–å‡½å¼
float read_your_sensor(void) {
    // æ‚¨çš„æ„Ÿæ¸¬å™¨é‚è¼¯
    return sensor_value;
}

// 2. åœ¨ç™¼å¸ƒå‡½å¼ä¸­æ·»åŠ 
if (rtk_mqtt_client_publish_telemetry(client, "your_metric", 
                                     read_your_sensor(), "unit") == RTK_SUCCESS) {
    printf("  âœ… æ‚¨çš„æ„Ÿæ¸¬å™¨: %.1f unit\n", read_your_sensor());
    success_count++;
}
```

## ğŸš€ é€²éšä½¿ç”¨

### è‡ªè¨‚ç¯„ä¾‹é–‹ç™¼

```bash
# 1. è¤‡è£½æœ€ç›¸ä¼¼çš„ç¯„ä¾‹
cp -r 02_basic_sensor my_custom_device

# 2. ä¿®æ”¹å°ˆæ¡ˆè³‡è¨Š
cd my_custom_device
sed -i 's/basic_sensor/my_custom_device/g' Makefile
sed -i 's/basic_sensor/my_custom_device/g' *.c

# 3. æ ¹æ“šéœ€æ±‚ä¿®æ”¹åŠŸèƒ½
nano sensor.c  # ä¿®æ”¹æ„Ÿæ¸¬å™¨é‚è¼¯
nano config.json  # èª¿æ•´é…ç½®
```

### æ•´åˆåˆ°æ‚¨çš„å°ˆæ¡ˆ

```bash
# 1. è¤‡è£½ç¨ç«‹ Makefile æ¨¡æ¿
cp 01_hello_world/Makefile your_project/

# 2. èª¿æ•´ RTK æ¡†æ¶è·¯å¾‘
# ç·¨è¼¯ Makefile ä¸­çš„è·¯å¾‘è¨­å®š

# 3. åƒè€ƒç¯„ä¾‹ä»£ç¢¼æ¨¡å¼
# ä½¿ç”¨ç¯„ä¾‹ä¸­çš„æœ€ä½³å¯¦è¸
```

### å»ºç«‹åˆ†ç™¼ç‰ˆæœ¬

```bash
# ä½¿ç”¨ 03_complete_device çš„æ‰“åŒ…åŠŸèƒ½
cd 03_complete_device
make package

# æŸ¥çœ‹ç”Ÿæˆçš„åˆ†ç™¼åŒ…
ls -la dist/
```

## ğŸ”— ç›¸é—œè³‡æº

### å®˜æ–¹æ–‡æª”
- **[MANUAL.md](../../docs/MANUAL.md)** - å®Œæ•´ä½¿ç”¨æ‰‹å†Š
- **[README.md](../../README.md)** - é–‹ç™¼è€…æŒ‡å—  
- **[RTK MQTT å”è­°è¦ç¯„](../../docs/SPEC.md)** - å”è­°è©³ç´°èªªæ˜

### å¤–éƒ¨è³‡æº
- **[MQTT å”è­°è¦ç¯„](https://mqtt.org/)** - MQTT å®˜æ–¹æ–‡æª”
- **[Eclipse Paho](https://www.eclipse.org/paho/)** - MQTT å®¢æˆ¶ç«¯å¯¦ä½œ
- **[test.mosquitto.org](https://test.mosquitto.org/)** - å…è²»æ¸¬è©¦ broker

### ç¤¾ç¾¤å’Œæ”¯æ´
- **å•é¡Œå›å ±**: è«‹åœ¨å°ˆæ¡ˆ repository ä¸­æäº¤ issue
- **åŠŸèƒ½å»ºè­°**: æ­¡è¿æäº¤ pull request
- **æŠ€è¡“è¨è«–**: åƒè€ƒå„ç¯„ä¾‹çš„ README.md ä¸­çš„æ•…éšœæ’é™¤ç« ç¯€

## ğŸ‰ é–‹å§‹æ‚¨çš„ RTK ä¹‹æ—…ï¼

é¸æ“‡ä¸€å€‹ç¯„ä¾‹é–‹å§‹æ‚¨çš„å­¸ç¿’ä¹‹æ—…ï¼š

```bash
# æœ€ç°¡å–®çš„é–‹å§‹æ–¹å¼
cd 01_hello_world
make run

# çœ‹åˆ° "Hello, RTK MQTT Framework!" æ¶ˆæ¯å¾Œï¼Œ
# æ‚¨å°±æ­£å¼é–‹å§‹äº† RTK MQTT Framework çš„å­¸ç¿’ï¼
```

ç¥æ‚¨å­¸ç¿’æ„‰å¿«ï¼å¦‚æœé‡åˆ°ä»»ä½•å•é¡Œï¼Œè«‹åƒè€ƒå„ç¯„ä¾‹çš„è©³ç´° README æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´åœ˜éšŠã€‚